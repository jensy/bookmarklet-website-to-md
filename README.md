# Website to Markdown

## Install the bookmarklet

Drag the link below to your bookmarks bar: <a href="javascript:(function(){function%20getUniqueSelector(e){if(e.id)return'%23'+CSS.escape(e.id);var%20t=[];while(e&&e.nodeType===Node.ELEMENT_NODE&&e!==document.body){var%20n=e.nodeName.toLowerCase();if(e.className){var%20r=e.className.trim().split(/\s+/);r[0]&&(n+='.'+CSS.escape(r[0]));}var%20a=e,s=1;while(a=a.previousElementSibling){if(a.nodeName.toLowerCase()===e.nodeName.toLowerCase())s++;}n+=':nth-of-type('+s+')',t.unshift(n),e=e.parentElement}return%20t.join(' > ')}function%20slugifyTitle(e){return%20e.normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-zA-Z0-9%20]/g,'').trim().toLowerCase().replace(/\s+/g,'-')}window.__extractionSelections=window.__extractionSelections||[];var%20selections=window.__extractionSelections;function%20moveSelection(i,s){if('up'===s&&i>0){var%20e=selections[i-1];selections[i-1]=selections[i],selections[i]=e}else%20if('down'===s&&i<selections.length-1){var%20e=selections[i];selections[i]=selections[i+1],selections[i+1]=e}window.__extractionSelections=selections,renderSelections()}function%20addSelectionItem(e,t,i){var%20li=document.createElement('li');li.style.marginBottom='5px',li.dataset.selector=t;var%20inp=document.createElement('input');inp.type='text',inp.value=e,inp.style.width='60%',inp.onchange=function(){var%20e=selections.filter(function(e){return%20e.selector===t})[0];e&&(e.label=inp.value)};inp.onfocus=function(){selections.forEach(function(sel){var%20els=document.querySelectorAll(sel.selector);els.forEach(function(el){el.style.outlineColor=(sel.selector===t)?'blue':'rgba(0,0,255,0.5)';});});};inp.onblur=function(){selections.forEach(function(sel){var%20els=document.querySelectorAll(sel.selector);els.forEach(function(el){el.style.outlineColor='blue';});});};var%20upBtn=document.createElement('button');upBtn.textContent='Up',upBtn.style.marginLeft='5px',upBtn.onclick=function(e){e.stopPropagation(),moveSelection(i,'up')};var%20downBtn=document.createElement('button');downBtn.textContent='Down',downBtn.style.marginLeft='5px',downBtn.onclick=function(e){e.stopPropagation(),moveSelection(i,'down')};var%20remBtn=document.createElement('button');remBtn.textContent='Remove',remBtn.style.marginLeft='5px',remBtn.onclick=function(e){e.stopPropagation();var%20els=document.querySelectorAll(t);els.forEach(function(el){el.classList.remove('extraction-highlight');});selections=selections.filter(function(e){return%20e.selector!==t}),window.__extractionSelections=selections,renderSelections();};li.appendChild(inp),li.appendChild(upBtn),li.appendChild(downBtn),li.appendChild(remBtn),document.getElementById('selection-list').appendChild(li)}function renderSelections(){var%20list=document.getElementById('selection-list');if(!list)return;list.innerHTML='',selections.forEach(function(e,i){addSelectionItem(e.label,e.selector,i);});}function clearAllHighlights(){selections.forEach(function(e){var%20els=document.querySelectorAll(e.selector);els.forEach(function(el){el.classList.remove('extraction-highlight'),el.style.outlineColor='';});});}var%20labelCounter=1,configKey='extractionConfig_'+window.location.origin;function applySavedConfig(){var%20cfg=localStorage.getItem(configKey);if(cfg)try{var%20t=JSON.parse(cfg);t.forEach(function(e){if(document.querySelector(e.selector)){if(!selections.find(function(t){return t.selector===e.selector}))selections.push(e);var%20els=document.querySelectorAll(e.selector);els.forEach(function(el){el.classList.add('extraction-highlight');});}else%20console.debug('Saved selector not found in DOM:',e.selector);});renderSelections();}catch(e){console.error('Error parsing saved config:',e);}}if(document.getElementById('extraction-sidebar')){document.getElementById('extraction-sidebar').style.display='block';renderSelections();setTimeout(applySavedConfig,1500);return;}var%20sidebar=document.createElement('div');sidebar.id='extraction-sidebar';sidebar.innerHTML='<div%20id="extraction-header"%20style="padding:10px;background:#f0f0f0;border-bottom:1px%20solid%20#ccc;color:#000;"><strong>Extraction%20UI</strong><button%20id="extraction-close"%20style="float:right;">X</button><div%20style="clear:both;"></div></div><div%20id="extraction-body"%20style="padding:10px;color:#000;"><p>Click%20elements%20to%20toggle%20selection/deselection.</p><ul%20id="selection-list"%20style="list-style:none;padding:0;"></ul><button%20id="create-markdown"%20style="margin-top:10px;">Create%20Markdown</button><button%20id="save-config"%20style="margin-top:10px;">Save%20Config</button><button%20id="clear-config"%20style="margin-top:10px;">Clear%20Saved%20Config</button><div%20id="markdown-preview-section"%20style="display:none;margin-top:10px;"><textarea%20id="markdown-preview"%20style="width:100%;height:200px;"></textarea><button%20id="download-markdown"%20style="margin-top:10px;">Download%20Markdown</button></div></div>';sidebar.style.position='fixed';sidebar.style.top='0';sidebar.style.right='0';sidebar.style.width='300px';sidebar.style.height='100%';sidebar.style.background='#fff';sidebar.style.borderLeft='1px%20solid%20#ccc';sidebar.style.zIndex='9999999';sidebar.style.overflowY='auto';sidebar.style.color='#000';document.body.appendChild(sidebar);var styleElem=document.createElement('style');styleElem.innerHTML=".extraction-highlight { outline: 1px solid blue !important; }";document.head.appendChild(styleElem);renderSelections();setTimeout(applySavedConfig,1500);var clickHandler=function(e){if(e.composedPath().some(function(e){return e.id==='extraction-sidebar';}))return;if(e.composedPath().some(function(e){return e.getAttribute&&e.getAttribute('data-download-trigger')==='true';}))return;e.preventDefault();e.stopPropagation();var tgt=e.target;tgt===document.documentElement||tgt===document.body||(function(){var i=getUniqueSelector(tgt),r=tgt.tagName.toLowerCase()+'-'+(labelCounter++),o=selections.find(function(e){return e.selector===i});if(o){selections=selections.filter(function(e){return e.selector!==i;});tgt.classList.remove('extraction-highlight');window.__extractionSelections=selections;renderSelections();return;}tgt.classList.add('extraction-highlight');selections.push({label:r,selector:i});window.__extractionSelections=selections;renderSelections();}());};document.addEventListener('click',clickHandler,true);var keyupHandler=function(e){if(e.key==='Escape'||e.keyCode===27){var sb=document.getElementById('extraction-sidebar');if(sb){clearAllHighlights();sb.style.display='none';}document.removeEventListener('click',clickHandler,true);document.removeEventListener('keyup',keyupHandler,true);}};document.addEventListener('keyup',keyupHandler,true);document.getElementById('extraction-close').onclick=function(e){e.stopPropagation();clearAllHighlights();document.getElementById('extraction-sidebar').style.display='none';document.removeEventListener('click',clickHandler,true);document.removeEventListener('keyup',keyupHandler,true);};document.getElementById('create-markdown').onclick=function(e){e.stopPropagation();var title=document.title,url=window.location.href,d=new Date(),dateStr=(d.getMonth()+1).toString().padStart(2,'0')+'-'+d.getDate().toString().padStart(2,'0')+'-'+d.getFullYear(),md='---\ntitle: '+title+'\nurl: '+url+'\ndate: '+dateStr+'\n---\n\n';selections.forEach(function(e){var t=document.querySelector(e.selector),n=t?t.innerText.trim():"";md+='## '+e.label+'\n\n'+n+'\n\n';});var ps=document.getElementById('markdown-preview-section'),ta=document.getElementById('markdown-preview');ta.value=md,ps.style.display='block';};document.getElementById('download-markdown').onclick=function(e){e.stopPropagation();var t=document.getElementById('markdown-preview').value,d=new Date(),dateStr=(d.getMonth()+1).toString().padStart(2,'0')+'-'+d.getDate().toString().padStart(2,'0')+'-'+d.getFullYear(),a=slugifyTitle(document.title||'document'),i=dateStr+'_'+a+'.md',o=new Blob([t],{type:'text/markdown;charset=utf-8'}),l=document.createElement('a');l.href=URL.createObjectURL(o),l.download=i,l.style.display='none',l.setAttribute('data-download-trigger','true'),document.body.appendChild(l),l.click(),document.body.removeChild(l);};document.getElementById('save-config').onclick=function(e){e.stopPropagation();if(!selections.length){alert('No%20selections%20to%20save!');return;}localStorage.setItem(configKey,JSON.stringify(selections));alert('Configuration%20saved!');};document.getElementById('clear-config').onclick=function(e){e.stopPropagation();localStorage.removeItem(configKey);clearAllHighlights();selections=[];window.__extractionSelections=selections;renderSelections();alert('Saved%20configuration%20cleared.');};window.addEventListener('beforeunload',function(){document.removeEventListener('click',clickHandler,true);document.removeEventListener('keyup',keyupHandler,true);})();">Extraction Bookmarklet</a>


## Overview
The bookmarklet is a tool that lets you interactively select and label parts of a webpage and then export them as a Markdown file. It injects a sidebar UI into the page, where you can toggle selections, rearrange their order, and generate a file that includes metadata (title, URL, and date) along with your selected text.

## Goals
- **Interactive Selection:** Click on elements to add (or remove) them from your selection. Selected elements get a blue border.
- **Labeling & Reordering:** Edit labels for each selection and use "Up" and "Down" buttons to change their order.
- **Markdown Generation:** Create a Markdown file that starts with a YAML header (including page title, URL, and date) followed by sections for each selection.
- **Configuration Persistence:** Save your extraction configuration in the browser’s localStorage so you can reuse it on other pages of the same domain.
- **Clean Deactivation:** Remove all event listeners and visual highlights when you close the sidebar or press Escape, restoring normal webpage interaction.

## Implementation
- **UI Injection:**  
  The bookmarklet injects a sidebar (using vanilla HTML and inline CSS) into the current page. The sidebar contains a list for your selections and buttons for creating Markdown, saving, and clearing configurations.

- **Event Handling:**  
  A document-level click listener computes a unique CSS selector for each clicked element (using its tag name, first class, and nth-of-type index). If an element is already selected, clicking it again will remove the selection and its highlight. A keyup listener detects the Escape key to deactivate the tool.

- **Configuration Management:**  
  Selections are stored in an array and persisted using localStorage under a key based on the page’s origin. This makes it possible to load and reuse your saved selections on any page within the same domain.

- **Markdown Generation:**  
  When you create the Markdown, the script gathers the selected elements’ text and constructs a Markdown file with a YAML header. The file is then downloaded with a name generated from the current date and a slugified version of the page title.

- **Clean-Up:**  
  When closing the sidebar (via the X button or Escape key), the tool removes all highlights from the page and unregisters its event listeners, ensuring the page returns to its normal behavior.

## Usage
1. **Installation:**  
   Create a new bookmark in your browser and set its URL to the bookmarklet code.

2. **Activation:**  
   Click the bookmarklet to open the sidebar.

3. **Selection:**  
   Click on elements to toggle their selection. Edit labels or use the Up/Down buttons in the sidebar to reorder them.

4. **Generate & Download:**  
   Click "Create Markdown" to preview your content, then "Download Markdown" to save the file.

5. **Save/Reset Configuration:**  
   Use "Save Config" to store your selections or "Clear Saved Config" to remove them completely.

6. **Deactivation:**  
   Close the sidebar by clicking the X button or pressing Escape. This removes all highlights and event listeners, restoring normal page interaction.

## License
This project is open-sourced under the MIT License.
